<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="æœ¬åœ°æ–‡æœ¬åŠ è§£å¯†å·¥å…·ï¼Œä½¿ç”¨Argon2idå’ŒPBKDF2ï¼Œå®Œå…¨åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ">
  <title>ç¦»çº¿/åœ¨çº¿æ–‡æœ¬åŠ è§£å¯† â€” Argon2 (å¯é€‰) + å›é€€ PBKDF2</title>
  <style>
    :root {
      --bg: #f6f8fb;
      --card: #fff;
      --accent: #2563eb;
      --accent-hover: #1d4ed8;
      --secondary: #0ea5e9;
      --ok: #16a34a;
      --danger: #dc2626;
      --warning: #f59e0b;
      --muted: #6b7280;
      --border: #e6eef8;
      --text: #0f172a;
      --radius: 12px;
      --shadow: 0 8px 30px rgba(2, 6, 23, 0.08);
      --transition: all 0.2s ease;
    }
    
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0f172a;
        --card: #1e293b;
        --accent: #3b82f6;
        --accent-hover: #2563eb;
        --secondary: #38bdf8;
        --ok: #22c55e;
        --danger: #ef4444;
        --warning: #f59e0b;
        --muted: #94a3b8;
        --border: #334155;
        --text: #f1f5f9;
      }
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
      transition: var(--transition);
    }
    
    .wrap {
      max-width: 1000px;
      margin: 0 auto;
      background: var(--card);
      padding: 28px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: var(--transition);
    }
    
    header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border);
    }
    
    header h1 {
      font-size: 1.5rem;
      margin: 0;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header-icon {
      width: 28px;
      height: 28px;
      fill: var(--accent);
    }
    
    .description {
      color: var(--muted);
      margin-bottom: 24px;
      font-size: 0.95rem;
      line-height: 1.7;
    }
    
    .section {
      margin-bottom: 28px;
    }
    
    .section-title {
      font-size: 1.1rem;
      margin-bottom: 12px;
      color: var(--text);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .section-title svg {
      width: 18px;
      height: 18px;
      fill: var(--accent);
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--text);
    }
    
    textarea, input[type="password"], input[type="text"], select {
      width: 100%;
      padding: 14px;
      border-radius: 8px;
      border: 2px solid var(--border);
      background: var(--card);
      color: var(--text);
      font-family: inherit;
      font-size: 0.95rem;
      transition: var(--transition);
      resize: vertical;
    }
    
    textarea:focus, input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    
    textarea:hover, input:hover, select:hover {
      border-color: var(--accent);
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .card {
      background: var(--bg);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid var(--border);
      transition: var(--transition);
    }
    
    .card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
    }
    
    .row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 16px;
    }
    
    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 14px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.95rem;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      min-height: 48px;
    }
    
    button:hover:not(:disabled) {
      background: var(--accent-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2);
    }
    
    button:active:not(:disabled) {
      transform: translateY(0);
    }
    
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    button.secondary {
      background: transparent;
      color: var(--accent);
      border: 2px solid var(--border);
    }
    
    button.secondary:hover:not(:disabled) {
      background: rgba(37, 99, 235, 0.1);
      border-color: var(--accent);
    }
    
    button.danger {
      background: var(--danger);
    }
    
    button.danger:hover:not(:disabled) {
      background: #b91c1c;
    }
    
    button.warning {
      background: var(--warning);
    }
    
    button.warning:hover:not(:disabled) {
      background: #d97706;
    }
    
    .status {
      padding: 12px;
      border-radius: 8px;
      margin: 8px 0;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .status.ok {
      background: rgba(22, 163, 74, 0.1);
      color: var(--ok);
      border-left: 4px solid var(--ok);
    }
    
    .status.info {
      background: rgba(14, 165, 233, 0.1);
      color: var(--secondary);
      border-left: 4px solid var(--secondary);
    }
    
    .status.warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--warning);
      border-left: 4px solid var(--warning);
    }
    
    .status.error {
      background: rgba(220, 38, 38, 0.1);
      color: var(--danger);
      border-left: 4px solid var(--danger);
    }
    
    .kdf-info {
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: 6px;
      line-height: 1.5;
    }
    
    .preset-option {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
    }
    
    .preset-desc {
      font-size: 0.85rem;
      color: var(--muted);
    }
    
    .password-group {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .password-group input {
      flex: 1;
    }
    
    .toggle-password {
      background: transparent;
      border: none;
      color: var(--muted);
      padding: 10px;
      cursor: pointer;
      min-height: auto;
    }
    
    .toggle-password:hover {
      color: var(--text);
      background: var(--border);
    }
    
    .strength-meter {
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      margin-top: 8px;
      overflow: hidden;
    }
    
    .strength-bar {
      height: 100%;
      width: 0%;
      transition: var(--transition);
    }
    
    .strength-text {
      font-size: 0.8rem;
      margin-top: 4px;
      color: var(--muted);
    }
    
    .output-container {
      position: relative;
    }
    
    .output-actions {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 8px;
    }
    
    .output-btn {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 0.8rem;
      color: var(--text);
      cursor: pointer;
      transition: var(--transition);
    }
    
    .output-btn:hover {
      background: var(--accent);
      color: white;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }
    
    .modal-content {
      background: var(--card);
      padding: 30px;
      border-radius: var(--radius);
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: var(--shadow);
      animation: slideUp 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--border);
    }
    
    .modal-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text);
    }
    
    .close-modal {
      background: transparent;
      border: none;
      font-size: 24px;
      color: var(--muted);
      cursor: pointer;
      padding: 0;
      min-height: auto;
    }
    
    .close-modal:hover {
      color: var(--text);
    }
    
    .tips {
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.1), rgba(37, 99, 235, 0.05));
      padding: 20px;
      border-radius: 10px;
      margin-top: 24px;
    }
    
    .tips h3 {
      margin: 0 0 12px;
      color: var(--accent);
      font-size: 1.1rem;
    }
    
    .tips ul {
      padding-left: 20px;
    }
    
    .tips li {
      margin-bottom: 8px;
      color: var(--text);
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    .action-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin: 20px 0;
    }
    
    @media (max-width: 768px) {
      .wrap {
        padding: 16px;
      }
      
      .grid {
        grid-template-columns: 1fr;
      }
      
      .row {
        flex-direction: column;
      }
      
      button {
        width: 100%;
        justify-content: center;
      }
      
      .action-buttons {
        flex-direction: column;
      }
      
      .password-group {
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <main class="wrap">
    <header>
      <svg class="header-icon" viewBox="0 0 24 24">
        <path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
      </svg>
      <h1>ç¦»çº¿/åœ¨çº¿æ–‡æœ¬åŠ è§£å¯†</h1>
    </header>
    
    <p class="description">
      é»˜è®¤ä¼˜å…ˆç”¨ Argon2ï¼ˆæ›´å®‰å…¨ï¼‰æŠŠä½ è¾“å…¥çš„å£ä»¤åšæˆåŠ å¯†é’¥åŒ™ï¼›å¦‚æœæµè§ˆå™¨é‡Œæ²¡æœ‰è¿™ä¸ªåº“ï¼Œé¡µé¢ä¼šè‡ªåŠ¨é€€å›ä½¿ç”¨æµè§ˆå™¨è‡ªå¸¦çš„ PBKDF2ã€‚
      ä¸ºäº†æœ€å®‰å…¨ï¼Œå»ºè®®æŠŠæ•´å¥—æ–‡ä»¶ï¼ˆå«åº“ï¼‰ä¸‹è½½æ‰“åŒ…åç¦»çº¿å‘ç»™æœ‹å‹ï¼Œå¹¶é€šè¿‡å¦ä¸€æ¡æ¸ é“å•ç‹¬å‘ŠçŸ¥å£ä»¤æˆ–æ ¡éªŒç ã€‚
    </p>
    
    <section class="section">
      <h2 class="section-title">
        <svg viewBox="0 0 24 24">
          <path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
        </svg>
        åŠ å¯†è®¾ç½®
      </h2>
      
      <div class="grid">
        <div class="card">
          <label for="argonPreset">KDF ç®—æ³•ä¸é¢„è®¾</label>
          <select id="argonPreset">
            <option value="INTERACTIVE">Interactive (æœ€å¿«, å†…å­˜/æ—¶é—´æœ€å°)</option>
            <option value="MODERATE" selected>Moderate (å¹³è¡¡: æ¨è)</option>
            <option value="SENSITIVE">Sensitive (æ›´æ…¢æ›´å®‰å…¨)</option>
            <option value="CUSTOM">Custom (è‡ªå®šä¹‰å‚æ•°)</option>
          </select>
          
          <div id="customParams" style="display: none; margin-top: 12px;">
            <label>å†…å­˜é™åˆ¶ (MB)</label>
            <input type="range" id="memLimit" min="16" max="1024" step="16" value="256">
            <div class="preset-option"><span>å†…å­˜:</span><span id="memValue">256 MB</span></div>
            
            <label>æ“ä½œé™åˆ¶</label>
            <input type="range" id="opsLimit" min="2" max="10" step="1" value="5">
            <div class="preset-option"><span>å¼ºåº¦:</span><span id="opsValue">ä¸­ç­‰ (5)</span></div>
          </div>
          
          <div class="kdf-info">
            <span id="kdfStatus">æ£€æµ‹ä¸­...</span>
            <div style="margin-top: 8px;">
              <button id="loadSodiumBtn" class="secondary" style="padding: 8px 12px; font-size: 0.85rem;">
                åŠ è½½ libsodium
              </button>
            </div>
          </div>
        </div>
        
        <div class="card">
          <div class="section-title">ç®—æ³•ä¿¡æ¯</div>
          <div class="kdf-info">
            <p><strong>Argon2id</strong>: å†…å­˜å›°éš¾å¯†ç å“ˆå¸Œå‡½æ•°ï¼ŒæŠµæŠ—ä¾§ä¿¡é“æ”»å‡»</p>
            <p><strong>PBKDF2</strong>: åŸºäºSHA-256çš„å¯†é’¥æ´¾ç”Ÿå‡½æ•°ï¼Œ200,000æ¬¡è¿­ä»£</p>
            <p><strong>AES-GCM</strong>: è®¤è¯åŠ å¯†ç®—æ³•ï¼Œ256ä½å¯†é’¥</p>
          </div>
          <div class="status info" id="algorithmInfo">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            ä½¿ç”¨ç°ä»£åŠ å¯†æ ‡å‡†ï¼Œç¡®ä¿æ•°æ®æœºå¯†æ€§å’Œå®Œæ•´æ€§
          </div>
        </div>
      </div>
    </section>
    
    <section class="section">
      <h2 class="section-title">
        <svg viewBox="0 0 24 24">
          <path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
        </svg>
        è¾“å…¥æ–‡æœ¬ä¸å£ä»¤
      </h2>
      
      <div class="grid">
        <div class="card">
          <label for="plaintext">è¦åŠ å¯†çš„æ–‡æœ¬</label>
          <textarea id="plaintext" rows="6" placeholder="åœ¨æ­¤è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬..."></textarea>
          <div class="row">
            <button id="clearTextBtn" class="secondary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
              æ¸…ç©º
            </button>
            <button id="sampleTextBtn" class="secondary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
              </svg>
              ç¤ºä¾‹æ–‡æœ¬
            </button>
          </div>
        </div>
        
        <div class="card">
          <label for="password">å£ä»¤</label>
          <div class="password-group">
            <input id="password" type="password" placeholder="è¾“å…¥åŠ å¯†å£ä»¤...">
            <button id="togglePassword" class="toggle-password" title="æ˜¾ç¤º/éšè—å£ä»¤">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              </svg>
            </button>
          </div>
          
          <div class="strength-meter">
            <div id="strengthBar" class="strength-bar"></div>
          </div>
          <div id="strengthText" class="strength-text">å£ä»¤å¼ºåº¦</div>
          
          <div class="row" style="margin-top: 16px;">
            <button id="genBtn" class="secondary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M13 10V3L4 14h7v7l9-11h-7z"/>
              </svg>
              ç”Ÿæˆå£ä»¤
            </button>
            <button id="copyPassBtn" class="secondary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
              </svg>
              å¤åˆ¶å£ä»¤
            </button>
          </div>
        </div>
      </div>
    </section>
    
    <section class="section">
      <h2 class="section-title">
        <svg viewBox="0 0 24 24">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        æ“ä½œ
      </h2>
      
      <div class="action-buttons">
        <button id="encryptBtn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
          </svg>
          åŠ å¯†æ–‡æœ¬
        </button>
        
        <button id="decryptBtn" class="secondary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/>
          </svg>
          è§£å¯†æ–‡æœ¬
        </button>
        
        <button id="copyBtn" class="secondary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
          </svg>
          å¤åˆ¶è¾“å‡º
        </button>
        
        <button id="downloadBtn" class="secondary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
          </svg>
          ä¸‹è½½å¯†æ–‡
        </button>
        
        <a href="verify.html" style="text-decoration: none;">
          <button class="warning">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
            </svg>
            æ–‡ä»¶æ ¡éªŒå·¥å…·
          </button>
        </a>
        
        <button id="securityCheckBtn" class="secondary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
          </svg>
          å®‰å…¨æ£€æŸ¥
        </button>
      </div>
    </section>
    
    <section class="section">
      <h2 class="section-title">
        <svg viewBox="0 0 24 24">
          <path d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
        </svg>
        è¾“å‡ºç»“æœ
      </h2>
      
      <div class="output-container">
        <label for="output">åŠ å¯†è¾“å‡ºï¼ˆBase64 JSONæ ¼å¼ï¼‰</label>
        <textarea id="output" rows="6" placeholder="åŠ å¯†æˆ–è§£å¯†çš„ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
        
        <div class="output-actions">
          <button class="output-btn" id="formatOutputBtn">æ ¼å¼åŒ–</button>
          <button class="output-btn" id="minifyOutputBtn">å‹ç¼©</button>
          <button class="output-btn" id="viewOutputBtn">æŸ¥çœ‹è¯¦æƒ…</button>
        </div>
      </div>
      
      <div class="row" style="margin-top: 12px;">
        <button id="clearOutputBtn" class="secondary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
          </svg>
          æ¸…ç©ºè¾“å‡º
        </button>
        <div id="operationStatus" class="status" style="flex: 1; display: none;"></div>
      </div>
    </section>
    
    <div class="tips">
      <h3>å®‰å…¨ä½¿ç”¨å»ºè®®</h3>
      <ul>
        <li>ğŸ”’ è‹¥è¦ç¦»çº¿ä½¿ç”¨ï¼Œè¯·æŠŠæœ¬é¡µè¿åŒ libsodium åº“æ‰“åŒ…å‘ç»™æœ‹å‹å¹¶è®©æœ‹å‹åœ¨æœ¬åœ°æ‰“å¼€ verify.html æ ¡éªŒå“ˆå¸Œå†ä½¿ç”¨ã€‚</li>
        <li>âš¡ è‹¥é¡µé¢çŸ­æš‚å¡é¡¿ï¼ˆArgon2 è®¡ç®—æœŸé—´ï¼‰ï¼Œå±äºæ­£å¸¸ï¼Œè¯´æ˜æ´¾ç”Ÿè¾ƒå¼ºã€‚å¯é€‰æ‹© preset é™ä½å¼ºåº¦ã€‚</li>
        <li>ğŸ”‘ å»ºè®®å£ä»¤é•¿åº¦è‡³å°‘12ä¸ªå­—ç¬¦ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ã€‚</li>
        <li>ğŸ“± é€šè¿‡ä¸åŒæ¸ é“ä¼ è¾“å¯†æ–‡å’Œå£ä»¤ï¼ˆä¾‹å¦‚ï¼šå¯†æ–‡é€šè¿‡èŠå¤©è½¯ä»¶å‘é€ï¼Œå£ä»¤é€šè¿‡ç”µè¯å‘ŠçŸ¥ï¼‰ã€‚</li>
        <li>ğŸ’¾ å®šæœŸæ›´æ–°æ‚¨çš„åŠ å¯†å£ä»¤ï¼Œä¸è¦é‡å¤ä½¿ç”¨ç›¸åŒå£ä»¤ã€‚</li>
      </ul>
    </div>
  </main>
  
  <!-- å®‰å…¨æ£€æŸ¥æ¨¡æ€æ¡† -->
  <div id="securityModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">å®‰å…¨æ£€æŸ¥</h2>
        <button class="close-modal" id="closeSecurityModal">&times;</button>
      </div>
      <div id="securityCheckResults">
        <!-- å®‰å…¨æ£€æŸ¥ç»“æœå°†åŠ¨æ€æ’å…¥ -->
      </div>
      <button id="runSecurityCheck" style="margin-top: 20px;">é‡æ–°è¿è¡Œæ£€æŸ¥</button>
    </div>
  </div>
  
  <!-- è¾“å‡ºè¯¦æƒ…æ¨¡æ€æ¡† -->
  <div id="outputModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">åŠ å¯†è¾“å‡ºè¯¦æƒ…</h2>
        <button class="close-modal" id="closeOutputModal">&times;</button>
      </div>
      <pre id="outputDetails" style="background: var(--bg); padding: 15px; border-radius: 8px; overflow: auto; font-family: 'Courier New', monospace; font-size: 0.9rem;"></pre>
    </div>
  </div>

  <!-- åŠ è½½libsodiumçš„è„šæœ¬ -->
  <script>
    // é…ç½®
    const CONFIG = {
      PBKDF2_ITERATIONS: 200000,
      DEFAULT_PRESET: 'MODERATE',
      SALT_LENGTHS: {
        ARGON2: 16,  // libsodiumé»˜è®¤ç›é•¿åº¦
        PBKDF2: 16
      }
    };

    // DOMå…ƒç´ 
    const $ = id => document.getElementById(id);
    const elements = {
      // è¾“å…¥
      plaintext: $('plaintext'),
      password: $('password'),
      togglePassword: $('togglePassword'),
      
      // é…ç½®
      argonPreset: $('argonPreset'),
      customParams: $('customParams'),
      memLimit: $('memLimit'),
      memValue: $('memValue'),
      opsLimit: $('opsLimit'),
      opsValue: $('opsValue'),
      
      // è¾“å‡º
      output: $('output'),
      
      // æŒ‰é’®
      encryptBtn: $('encryptBtn'),
      decryptBtn: $('decryptBtn'),
      copyBtn: $('copyBtn'),
      downloadBtn: $('downloadBtn'),
      genBtn: $('genBtn'),
      copyPassBtn: $('copyPassBtn'),
      clearTextBtn: $('clearTextBtn'),
      clearOutputBtn: $('clearOutputBtn'),
      sampleTextBtn: $('sampleTextBtn'),
      loadSodiumBtn: $('loadSodiumBtn'),
      securityCheckBtn: $('securityCheckBtn'),
      
      // çŠ¶æ€
      kdfStatus: $('kdfStatus'),
      algorithmInfo: $('algorithmInfo'),
      operationStatus: $('operationStatus'),
      
      // å£ä»¤å¼ºåº¦
      strengthBar: $('strengthBar'),
      strengthText: $('strengthText'),
      
      // æ¨¡æ€æ¡†
      securityModal: $('securityModal'),
      closeSecurityModal: $('closeSecurityModal'),
      securityCheckResults: $('securityCheckResults'),
      runSecurityCheck: $('runSecurityCheck'),
      outputModal: $('outputModal'),
      closeOutputModal: $('closeOutputModal'),
      outputDetails: $('outputDetails'),
      
      // è¾“å‡ºæ“ä½œ
      formatOutputBtn: $('formatOutputBtn'),
      minifyOutputBtn: $('minifyOutputBtn'),
      viewOutputBtn: $('viewOutputBtn')
    };

    // çŠ¶æ€å˜é‡
    let sodiumReady = false;
    let sodium = null;
    let isPasswordVisible = false;
    let currentOperation = null;

    // å·¥å…·å‡½æ•°
    const utils = {
      encoder: new TextEncoder(),
      decoder: new TextDecoder(),

      // ç”Ÿæˆéšæœºå­—èŠ‚
      randomBytes(length) {
        const bytes = new Uint8Array(length);
        crypto.getRandomValues(bytes);
        return bytes;
      },

      // ArrayBufferè½¬Base64
      arrayBufferToBase64(buffer) {
        const bytes = new Uint8Array(buffer);
        let binary = '';
        const chunkSize = 0x8000; // 32KB chunks
        
        for (let i = 0; i < bytes.length; i += chunkSize) {
          binary += String.fromCharCode.apply(null, bytes.subarray(i, i + chunkSize));
        }
        
        return btoa(binary);
      },

      // Base64è½¬ArrayBuffer
      base64ToArrayBuffer(base64) {
        const binary = atob(base64);
        const bytes = new Uint8Array(binary.length);
        
        for (let i = 0; i < binary.length; i++) {
          bytes[i] = binary.charCodeAt(i);
        }
        
        return bytes.buffer;
      },

      // æ ¼å¼åŒ–JSON
      formatJSON(json, pretty = true) {
        try {
          const parsed = typeof json === 'string' ? JSON.parse(json) : json;
          return pretty ? JSON.stringify(parsed, null, 2) : JSON.stringify(parsed);
        } catch (e) {
          return json;
        }
      },

      // è®¡ç®—å£ä»¤å¼ºåº¦
      calculatePasswordStrength(password) {
        if (!password) return { score: 0, text: 'æœªè¾“å…¥' };
        
        let score = 0;
        const length = password.length;
        
        // é•¿åº¦è¯„åˆ†
        if (length >= 8) score += 1;
        if (length >= 12) score += 1;
        if (length >= 16) score += 1;
        
        // å­—ç¬¦ç±»å‹è¯„åˆ†
        if (/[a-z]/.test(password)) score += 1; // å°å†™å­—æ¯
        if (/[A-Z]/.test(password)) score += 1; // å¤§å†™å­—æ¯
        if (/[0-9]/.test(password)) score += 1; // æ•°å­—
        if (/[^a-zA-Z0-9]/.test(password)) score += 1; // ç‰¹æ®Šå­—ç¬¦
        
        // å¤šæ ·æ€§è¯„åˆ†
        const uniqueChars = new Set(password).size;
        if (uniqueChars / length > 0.7) score += 1;
        
        // æ˜ å°„åˆ°0-100çš„åˆ†æ•°å’Œæ–‡æœ¬æè¿°
        const maxScore = 8;
        const percentage = Math.min(100, Math.round((score / maxScore) * 100));
        
        let text, color;
        if (percentage < 30) {
          text = 'å¼±';
          color = '#dc2626'; // çº¢è‰²
        } else if (percentage < 60) {
          text = 'ä¸€èˆ¬';
          color = '#f59e0b'; // é»„è‰²
        } else if (percentage < 80) {
          text = 'è‰¯å¥½';
          color = '#16a34a'; // ç»¿è‰²
        } else {
          text = 'å¼º';
          color = '#059669'; // æ·±ç»¿è‰²
        }
        
        return { 
          score: percentage, 
          text: `${text} (${percentage}%)`,
          color 
        };
      },

      // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
      showStatus(message, type = 'info', duration = 5000) {
        const statusEl = elements.operationStatus;
        statusEl.textContent = message;
        statusEl.className = `status ${type}`;
        statusEl.style.display = 'flex';
        
        if (duration > 0) {
          setTimeout(() => {
            statusEl.style.display = 'none';
          }, duration);
        }
      },

      // åŠ è½½libsodium
      async loadLibsodium() {
        try {
          elements.loadSodiumBtn.disabled = true;
          elements.loadSodiumBtn.innerHTML = '<span class="loading"></span> åŠ è½½ä¸­...';
          
          // å°è¯•ä»CDNåŠ è½½
          const script = document.createElement('script');
          script.src = 'https://cdn.jsdelivr.net/npm/libsodium-wrappers@0.7.10/dist/modules/libsodium-wrappers.min.js';
          
          await new Promise((resolve, reject) => {
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
          });
          
          // ç­‰å¾…sodiumå‡†å¤‡å°±ç»ª
          await sodium.ready;
          sodiumReady = true;
          
          utils.showStatus('âœ… libsodium å·²æˆåŠŸåŠ è½½', 'ok');
          updateKdfStatus();
        } catch (error) {
          console.error('åŠ è½½libsodiumå¤±è´¥:', error);
          utils.showStatus('âŒ åŠ è½½libsodiumå¤±è´¥ï¼Œå°†ä½¿ç”¨PBKDF2', 'error');
          sodiumReady = false;
        } finally {
          elements.loadSodiumBtn.disabled = false;
          elements.loadSodiumBtn.textContent = 'åŠ è½½ libsodium';
        }
      }
    };

    // æ›´æ–°KDFçŠ¶æ€æ˜¾ç¤º
    function updateKdfStatus() {
      if (sodiumReady && sodium) {
        const preset = elements.argonPreset.value;
        elements.kdfStatus.innerHTML = `
          <strong>âœ… Argon2id å¯ç”¨</strong> (${preset} é¢„è®¾)
          <div style="font-size: 0.85rem; margin-top: 4px; color: var(--ok);">
            ä½¿ç”¨ libsodium çš„ crypto_pwhash è¿›è¡Œå¯†é’¥æ´¾ç”Ÿ
          </div>
        `;
        elements.kdfStatus.className = 'status ok';
      } else {
        elements.kdfStatus.innerHTML = `
          <strong>âš ï¸ Argon2 ä¸å¯ç”¨</strong>
          <div style="font-size: 0.85rem; margin-top: 4px; color: var(--warning);">
            å›é€€ä½¿ç”¨ PBKDF2 (${CONFIG.PBKDF2_ITERATIONS.toLocaleString()} æ¬¡è¿­ä»£)
          </div>
        `;
        elements.kdfStatus.className = 'status warning';
      }
    }

    // æ£€æµ‹sodiumæ˜¯å¦å¯ç”¨
    async function detectSodium() {
      if (window.sodium) {
        sodium = window.sodium;
        try {
          await sodium.ready;
          sodiumReady = true;
        } catch (e) {
          sodiumReady = false;
        }
      }
      updateKdfStatus();
    }

    // å¯†é’¥æ´¾ç”Ÿå‡½æ•°
    async function deriveKey(password, salt, preset = CONFIG.DEFAULT_PRESET) {
      if (sodiumReady && sodium) {
        // ä½¿ç”¨Argon2id
        let opsLimit, memLimit;
        
        if (preset === 'CUSTOM') {
          opsLimit = Math.pow(2, parseInt(elements.opsLimit.value));
          memLimit = parseInt(elements.memLimit.value) * 1024 * 1024;
        } else if (preset === 'INTERACTIVE') {
          opsLimit = sodium.crypto_pwhash_OPSLIMIT_INTERACTIVE;
          memLimit = sodium.crypto_pwhash_MEMLIMIT_INTERACTIVE;
        } else if (preset === 'SENSITIVE') {
          opsLimit = sodium.crypto_pwhash_OPSLIMIT_SENSITIVE;
          memLimit = sodium.crypto_pwhash_MEMLIMIT_SENSITIVE;
        } else {
          opsLimit = sodium.crypto_pwhash_OPSLIMIT_MODERATE;
          memLimit = sodium.crypto_pwhash_MEMLIMIT_MODERATE;
        }
        
        const saltBytes = salt instanceof Uint8Array ? salt : new Uint8Array(salt);
        const keyBytes = sodium.crypto_pwhash(
          32, // å¯†é’¥é•¿åº¦ (32å­—èŠ‚ = 256ä½)
          password,
          saltBytes,
          opsLimit,
          memLimit,
          sodium.crypto_pwhash_ALG_ARGON2ID13
        );
        
        const keyBuffer = sodium.to_array_buffer(keyBytes);
        return crypto.subtle.importKey(
          'raw',
          keyBuffer,
          { name: 'AES-GCM', length: 256 },
          false,
          ['encrypt', 'decrypt']
        );
      } else {
        // å›é€€åˆ°PBKDF2
        const passwordKey = await crypto.subtle.importKey(
          'raw',
          utils.encoder.encode(password),
          { name: 'PBKDF2' },
          false,
          ['deriveKey']
        );
        
        return crypto.subtle.deriveKey(
          {
            name: 'PBKDF2',
            salt: salt.buffer || salt,
            iterations: CONFIG.PBKDF2_ITERATIONS,
            hash: 'SHA-256'
          },
          passwordKey,
          { name: 'AES-GCM', length: 256 },
          false,
          ['encrypt', 'decrypt']
        );
      }
    }

    // åŠ å¯†æ–‡æœ¬
    async function encryptText(plaintext, password) {
      const startTime = performance.now();
      
      // ç”Ÿæˆéšæœºç›å’ŒIV
      const saltLength = sodiumReady ? CONFIG.SALT_LENGTHS.ARGON2 : CONFIG.SALT_LENGTHS.PBKDF2;
      const salt = utils.randomBytes(saltLength);
      const iv = utils.randomBytes(12); // AES-GCMæ¨è12å­—èŠ‚IV
      
      // æ´¾ç”Ÿå¯†é’¥
      const preset = elements.argonPreset.value;
      const key = await deriveKey(password, salt, preset);
      
      // åŠ å¯†æ–‡æœ¬
      const ciphertext = await crypto.subtle.encrypt(
        {
          name: 'AES-GCM',
          iv: iv
        },
        key,
        utils.encoder.encode(plaintext)
      );
      
      // æ„å»ºè¾“å‡ºå¯¹è±¡
      const payload = {
        version: 2,
        timestamp: new Date().toISOString(),
        algorithm: 'AES-GCM-256',
        kdf: sodiumReady ? 'argon2id' : 'pbkdf2',
        preset: sodiumReady ? preset : undefined,
        salt: utils.arrayBufferToBase64(salt),
        iv: utils.arrayBufferToBase64(iv),
        ciphertext: utils.arrayBufferToBase64(ciphertext)
      };
      
      const endTime = performance.now();
      const duration = endTime - startTime;
      
      return {
        payload: btoa(JSON.stringify(payload)),
        duration: duration
      };
    }

    // è§£å¯†æ–‡æœ¬
    async function decryptText(encryptedData, password) {
      const startTime = performance.now();
      
      // è§£æåŠ å¯†æ•°æ®
      let payload;
      try {
        payload = JSON.parse(atob(encryptedData));
      } catch (e) {
        throw new Error('å¯†æ–‡æ ¼å¼é”™è¯¯ï¼šæ— æ³•è§£æBase64 JSON');
      }
      
      // éªŒè¯å¿…è¦å­—æ®µ
      if (!payload.salt || !payload.iv || !payload.ciphertext) {
        throw new Error('å¯†æ–‡ç¼ºå°‘å¿…è¦å­—æ®µ');
      }
      
      // è§£ç Base64æ•°æ®
      const salt = new Uint8Array(utils.base64ToArrayBuffer(payload.salt));
      const iv = new Uint8Array(utils.base64ToArrayBuffer(payload.iv));
      const ciphertext = utils.base64ToArrayBuffer(payload.ciphertext);
      
      // æ´¾ç”Ÿå¯†é’¥
      const preset = payload.preset || elements.argonPreset.value;
      const key = await deriveKey(password, salt, preset);
      
      // è§£å¯†æ–‡æœ¬
      const plaintextBuffer = await crypto.subtle.decrypt(
        {
          name: 'AES-GCM',
          iv: iv
        },
        key,
        ciphertext
      );
      
      const endTime = performance.now();
      const duration = endTime - startTime;
      
      return {
        text: utils.decoder.decode(plaintextBuffer),
        duration: duration,
        metadata: payload
      };
    }

    // å®‰å…¨æ£€æŸ¥
    async function runSecurityCheck() {
      const results = [];
      
      // æ£€æŸ¥1: Web Crypto API
      try {
        const subtle = crypto.subtle;
        if (subtle) {
          results.push({
            name: 'Web Crypto API',
            status: 'ok',
            message: 'æ”¯æŒç°ä»£åŠ å¯†API'
          });
        } else {
          results.push({
            name: 'Web Crypto API',
            status: 'error',
            message: 'æµè§ˆå™¨ä¸æ”¯æŒWeb Crypto APIï¼Œæ— æ³•ä½¿ç”¨åŠ å¯†åŠŸèƒ½'
          });
        }
      } catch (e) {
        results.push({
          name: 'Web Crypto API',
          status: 'error',
          message: 'æ£€æŸ¥Web Crypto APIæ—¶å‡ºé”™'
        });
      }
      
      // æ£€æŸ¥2: libsodiumçŠ¶æ€
      if (sodiumReady) {
        results.push({
          name: 'Argon2 (libsodium)',
          status: 'ok',
          message: 'å·²åŠ è½½ï¼Œæ”¯æŒArgon2idç®—æ³•'
        });
      } else {
        results.push({
          name: 'Argon2 (libsodium)',
          status: 'warning',
          message: 'æœªåŠ è½½ï¼Œå°†ä½¿ç”¨PBKDF2å›é€€æ–¹æ¡ˆ'
        });
      }
      
      // æ£€æŸ¥3: å®‰å…¨ä¸Šä¸‹æ–‡
      if (window.isSecureContext) {
        results.push({
          name: 'å®‰å…¨ä¸Šä¸‹æ–‡',
          status: 'ok',
          message: 'è¿è¡Œåœ¨å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ (HTTPSæˆ–localhost)'
        });
      } else {
        results.push({
          name: 'å®‰å…¨ä¸Šä¸‹æ–‡',
          status: 'warning',
          message: 'æœªè¿è¡Œåœ¨å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½å—é™'
        });
      }
      
      // æ£€æŸ¥4: å‰ªè´´æ¿API
      try {
        if (navigator.clipboard) {
          results.push({
            name: 'å‰ªè´´æ¿API',
            status: 'ok',
            message: 'æ”¯æŒå‰ªè´´æ¿è¯»å†™'
          });
        } else {
          results.push({
            name: 'å‰ªè´´æ¿API',
            status: 'warning',
            message: 'å‰ªè´´æ¿APIä¸å¯ç”¨ï¼Œå¤åˆ¶åŠŸèƒ½å—é™'
          });
        }
      } catch (e) {
        results.push({
          name: 'å‰ªè´´æ¿API',
          status: 'warning',
          message: 'å‰ªè´´æ¿APIæ£€æŸ¥å¤±è´¥'
        });
      }
      
      // æ˜¾ç¤ºç»“æœ
      displaySecurityResults(results);
    }

    function displaySecurityResults(results) {
      const container = elements.securityCheckResults;
      container.innerHTML = '';
      
      results.forEach(result => {
        const resultEl = document.createElement('div');
        resultEl.className = `status ${result.status}`;
        resultEl.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px;">
            <strong>${result.name}</strong>
            <span style="margin-left: auto; font-weight: bold;">
              ${result.status === 'ok' ? 'âœ…' : result.status === 'warning' ? 'âš ï¸' : 'âŒ'}
            </span>
          </div>
          <div style="margin-top: 4px; font-size: 0.9rem;">${result.message}</div>
        `;
        container.appendChild(resultEl);
      });
    }

    // äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      // åŠ å¯†æŒ‰é’®
      elements.encryptBtn.addEventListener('click', async () => {
        const plaintext = elements.plaintext.value.trim();
        const password = elements.password.value.trim();
        
        if (!plaintext) {
          utils.showStatus('è¯·è¾“å…¥è¦åŠ å¯†çš„æ–‡æœ¬', 'warning');
          return;
        }
        
        if (!password) {
          utils.showStatus('è¯·è¾“å…¥åŠ å¯†å£ä»¤', 'warning');
          return;
        }
        
        try {
          elements.encryptBtn.disabled = true;
          elements.encryptBtn.innerHTML = '<span class="loading"></span> åŠ å¯†ä¸­...';
          
          const { payload, duration } = await encryptText(plaintext, password);
          elements.output.value = payload;
          
          utils.showStatus(`âœ… åŠ å¯†å®Œæˆ (${duration.toFixed(0)}ms)`, 'ok');
        } catch (error) {
          console.error('åŠ å¯†å¤±è´¥:', error);
          utils.showStatus(`åŠ å¯†å¤±è´¥: ${error.message}`, 'error');
        } finally {
          elements.encryptBtn.disabled = false;
          elements.encryptBtn.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
            åŠ å¯†æ–‡æœ¬
          `;
        }
      });
      
      // è§£å¯†æŒ‰é’®
      elements.decryptBtn.addEventListener('click', async () => {
        const encryptedData = elements.output.value.trim();
        const password = elements.password.value.trim();
        
        if (!encryptedData) {
          utils.showStatus('è¯·è¾“å…¥è¦è§£å¯†çš„å¯†æ–‡', 'warning');
          return;
        }
        
        if (!password) {
          utils.showStatus('è¯·è¾“å…¥è§£å¯†å£ä»¤', 'warning');
          return;
        }
        
        try {
          elements.decryptBtn.disabled = true;
          elements.decryptBtn.innerHTML = '<span class="loading"></span> è§£å¯†ä¸­...';
          
          const { text, duration, metadata } = await decryptText(encryptedData, password);
          elements.plaintext.value = text;
          
          let message = `âœ… è§£å¯†å®Œæˆ (${duration.toFixed(0)}ms)`;
          if (metadata.kdf) {
            message += `ï¼Œä½¿ç”¨ ${metadata.kdf.toUpperCase()}`;
          }
          
          utils.showStatus(message, 'ok');
        } catch (error) {
          console.error('è§£å¯†å¤±è´¥:', error);
          utils.showStatus(`è§£å¯†å¤±è´¥: ${error.message}`, 'error');
        } finally {
          elements.decryptBtn.disabled = false;
          elements.decryptBtn.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"/>
            </svg>
            è§£å¯†æ–‡æœ¬
          `;
        }
      });
      
      // ç”Ÿæˆéšæœºå£ä»¤
      elements.genBtn.addEventListener('click', () => {
        const length = 20;
        const charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()-_=+[]{}<>?,.;:';
        const randomValues = new Uint8Array(length);
        crypto.getRandomValues(randomValues);
        
        let password = '';
        for (let i = 0; i < length; i++) {
          password += charset[randomValues[i] % charset.length];
        }
        
        elements.password.value = password;
        updatePasswordStrength();
        utils.showStatus('âœ… å·²ç”Ÿæˆéšæœºå£ä»¤', 'ok');
      });
      
      // å¤åˆ¶å£ä»¤
      elements.copyPassBtn.addEventListener('click', async () => {
        const password = elements.password.value;
        if (!password) {
          utils.showStatus('æ²¡æœ‰å£ä»¤å¯å¤åˆ¶', 'warning');
          return;
        }
        
        try {
          await navigator.clipboard.writeText(password);
          utils.showStatus('âœ… å£ä»¤å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'ok');
        } catch (error) {
          utils.showStatus(`å¤åˆ¶å¤±è´¥: ${error.message}`, 'error');
        }
      });
      
      // å¤åˆ¶è¾“å‡º
      elements.copyBtn.addEventListener('click', async () => {
        const output = elements.output.value;
        if (!output) {
          utils.showStatus('æ²¡æœ‰è¾“å‡ºå¯å¤åˆ¶', 'warning');
          return;
        }
        
        try {
          await navigator.clipboard.writeText(output);
          utils.showStatus('âœ… è¾“å‡ºå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'ok');
        } catch (error) {
          utils.showStatus(`å¤åˆ¶å¤±è´¥: ${error.message}`, 'error');
        }
      });
      
      // ä¸‹è½½è¾“å‡º
      elements.downloadBtn.addEventListener('click', () => {
        const output = elements.output.value;
        if (!output) {
          utils.showStatus('æ²¡æœ‰è¾“å‡ºå¯ä¸‹è½½', 'warning');
          return;
        }
        
        try {
          const blob = new Blob([output], { type: 'text/plain;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `encrypted_${Date.now()}.txt`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          
          utils.showStatus('âœ… è¾“å‡ºå·²ä¸‹è½½', 'ok');
        } catch (error) {
          utils.showStatus(`ä¸‹è½½å¤±è´¥: ${error.message}`, 'error');
        }
      });
      
      // æ¸…ç©ºæ–‡æœ¬
      elements.clearTextBtn.addEventListener('click', () => {
        elements.plaintext.value = '';
        utils.showStatus('å·²æ¸…ç©ºè¾“å…¥æ–‡æœ¬', 'info');
      });
      
      // æ¸…ç©ºè¾“å‡º
      elements.clearOutputBtn.addEventListener('click', () => {
        elements.output.value = '';
        utils.showStatus('å·²æ¸…ç©ºè¾“å‡º', 'info');
      });
      
      // ç¤ºä¾‹æ–‡æœ¬
      elements.sampleTextBtn.addEventListener('click', () => {
        const sampleText = `è¿™æ˜¯ä¸€ä¸ªåŠ å¯†ç¤ºä¾‹æ–‡æœ¬ã€‚

ä½¿ç”¨è¯´æ˜ï¼š
1. è¾“å…¥ä¸€ä¸ªå¼ºå£ä»¤ï¼ˆå»ºè®®12ä½ä»¥ä¸Šï¼‰
2. ç‚¹å‡»"åŠ å¯†æ–‡æœ¬"æŒ‰é’®
3. å°†ç”Ÿæˆçš„å¯†æ–‡å‘é€ç»™æ¥æ”¶æ–¹
4. é€šè¿‡å¦ä¸€æ¸ é“å‘ŠçŸ¥å£ä»¤

å®‰å…¨æç¤ºï¼š
- ä¸è¦åœ¨ä¸å®‰å…¨çš„ç½‘ç»œä¸Šä¼ è¾“æ•æ„Ÿä¿¡æ¯
- å®šæœŸæ›´æ¢åŠ å¯†å£ä»¤
- éªŒè¯æ–‡ä»¶å®Œæ•´æ€§åå†ä½¿ç”¨`;

        elements.plaintext.value = sampleText;
        utils.showStatus('å·²åŠ è½½ç¤ºä¾‹æ–‡æœ¬', 'info');
      });
      
      // åˆ‡æ¢å£ä»¤å¯è§æ€§
      elements.togglePassword.addEventListener('click', () => {
        isPasswordVisible = !isPasswordVisible;
        elements.password.type = isPasswordVisible ? 'text' : 'password';
        
        elements.togglePassword.innerHTML = isPasswordVisible ? 
          `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L6.59 6.59m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>
          </svg>` :
          `<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            <path d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
          </svg>`;
      });
      
      // æ›´æ–°å£ä»¤å¼ºåº¦
      elements.password.addEventListener('input', updatePasswordStrength);
      
      // åŠ è½½libsodium
      elements.loadSodiumBtn.addEventListener('click', utils.loadLibsodium);
      
      // å®‰å…¨æ£€æŸ¥
      elements.securityCheckBtn.addEventListener('click', () => {
        elements.securityModal.style.display = 'flex';
        runSecurityCheck();
      });
      
      elements.closeSecurityModal.addEventListener('click', () => {
        elements.securityModal.style.display = 'none';
      });
      
      elements.runSecurityCheck.addEventListener('click', runSecurityCheck);
      
      // è¾“å‡ºæ“ä½œ
      elements.formatOutputBtn.addEventListener('click', () => {
        const output = elements.output.value;
        if (!output) {
          utils.showStatus('æ²¡æœ‰è¾“å‡ºå¯æ ¼å¼åŒ–', 'warning');
          return;
        }
        
        try {
          const formatted = utils.formatJSON(output);
          elements.output.value = formatted;
          utils.showStatus('âœ… è¾“å‡ºå·²æ ¼å¼åŒ–', 'ok');
        } catch (error) {
          utils.showStatus('æ ¼å¼åŒ–å¤±è´¥: æ— æ•ˆçš„JSONæ ¼å¼', 'error');
        }
      });
      
      elements.minifyOutputBtn.addEventListener('click', () => {
        const output = elements.output.value;
        if (!output) {
          utils.showStatus('æ²¡æœ‰è¾“å‡ºå¯å‹ç¼©', 'warning');
          return;
        }
        
        try {
          const minified = utils.formatJSON(output, false);
          elements.output.value = minified;
          utils.showStatus('âœ… è¾“å‡ºå·²å‹ç¼©', 'ok');
        } catch (error) {
          utils.showStatus('å‹ç¼©å¤±è´¥: æ— æ•ˆçš„JSONæ ¼å¼', 'error');
        }
      });
      
      elements.viewOutputBtn.addEventListener('click', () => {
        const output = elements.output.value;
        if (!output) {
          utils.showStatus('æ²¡æœ‰è¾“å‡ºå¯æŸ¥çœ‹', 'warning');
          return;
        }
        
        try {
          const parsed = JSON.parse(atob(output));
          elements.outputDetails.textContent = utils.formatJSON(parsed);
          elements.outputModal.style.display = 'flex';
        } catch (error) {
          utils.showStatus('æŸ¥çœ‹è¯¦æƒ…å¤±è´¥: æ— æ•ˆçš„åŠ å¯†æ•°æ®', 'error');
        }
      });
      
      elements.closeOutputModal.addEventListener('click', () => {
        elements.outputModal.style.display = 'none';
      });
      
      // é¢„è®¾é€‰æ‹©
      elements.argonPreset.addEventListener('change', function() {
        if (this.value === 'CUSTOM') {
          elements.customParams.style.display = 'block';
        } else {
          elements.customParams.style.display = 'none';
        }
        updateKdfStatus();
      });
      
      // è‡ªå®šä¹‰å‚æ•°
      elements.memLimit.addEventListener('input', function() {
        elements.memValue.textContent = `${this.value} MB`;
      });
      
      elements.opsLimit.addEventListener('input', function() {
        const values = ['å¾ˆä½', 'ä½', 'è¾ƒä½', 'ä¸­ä½', 'ä¸­ç­‰', 'ä¸­é«˜', 'é«˜', 'å¾ˆé«˜', 'æé«˜', 'æœ€å¼º'];
        elements.opsValue.textContent = `${values[this.value - 2] || 'ä¸­ç­‰'} (${this.value})`;
      });
      
      // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
      window.addEventListener('click', (event) => {
        if (event.target === elements.securityModal) {
          elements.securityModal.style.display = 'none';
        }
        if (event.target === elements.outputModal) {
          elements.outputModal.style.display = 'none';
        }
      });
      
      // é”®ç›˜å¿«æ·é”®
      document.addEventListener('keydown', (event) => {
        // Ctrl+Enter: åŠ å¯†
        if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
          if (elements.plaintext.value && elements.password.value) {
            event.preventDefault();
            elements.encryptBtn.click();
          }
        }
        
        // Ctrl+E: åŠ å¯†
        if ((event.ctrlKey || event.metaKey) && event.key === 'e') {
          event.preventDefault();
          elements.encryptBtn.click();
        }
        
        // Ctrl+D: è§£å¯†
        if ((event.ctrlKey || event.metaKey) && event.key === 'd') {
          event.preventDefault();
          elements.decryptBtn.click();
        }
        
        // Ctrl+G: ç”Ÿæˆå£ä»¤
        if ((event.ctrlKey || event.metaKey) && event.key === 'g') {
          event.preventDefault();
          elements.genBtn.click();
        }
        
        // Ctrl+Delete: æ¸…ç©ºæ‰€æœ‰
        if ((event.ctrlKey || event.metaKey) && event.key === 'Delete') {
          event.preventDefault();
          elements.clearTextBtn.click();
          elements.clearOutputBtn.click();
        }
      });
    }

    // æ›´æ–°å£ä»¤å¼ºåº¦æ˜¾ç¤º
    function updatePasswordStrength() {
      const password = elements.password.value;
      const strength = utils.calculatePasswordStrength(password);
      
      elements.strengthBar.style.width = `${strength.score}%`;
      elements.strengthBar.style.backgroundColor = strength.color;
      elements.strengthText.textContent = `å£ä»¤å¼ºåº¦: ${strength.text}`;
    }

    // åˆå§‹åŒ–
    async function init() {
      console.log('æ–‡æœ¬åŠ è§£å¯†å·¥å…·åˆå§‹åŒ–...');
      
      // æ£€æµ‹libsodium
      await detectSodium();
      
      // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
      setupEventListeners();
      
      // åˆå§‹åŒ–å£ä»¤å¼ºåº¦æ˜¾ç¤º
      updatePasswordStrength();
      
      // æ˜¾ç¤ºåˆå§‹åŒ–å®Œæˆæ¶ˆæ¯
      utils.showStatus('å·¥å…·å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹åŠ å¯†/è§£å¯†æ“ä½œ', 'ok', 3000);
      
      // æ·»åŠ CSSåŠ¨ç”»
      const style = document.createElement('style');
      style.textContent = `
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        .loading {
          animation: spin 1s linear infinite;
        }
      `;
      document.head.appendChild(style);
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
